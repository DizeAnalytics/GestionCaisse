<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>État Général - Gestion des Caisses</title>
    <style>
        /* Styles optimisés pour l'impression */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
            color: #000;
            background: #fff;
            font-size: 10pt;
        }
        
        /* En-tête */
        .header {
            text-align: center;
            padding: 20pt;
            border-bottom: 2pt solid #000;
            margin-bottom: 20pt;
        }
        
        .title {
            font-size: 18pt;
            font-weight: bold;
            margin-bottom: 10pt;
        }
        
        .subtitle {
            font-size: 12pt;
            margin-bottom: 15pt;
        }
        
        .meta {
            font-size: 9pt;
            color: #666;
        }
        
        /* Informations de l'entreprise */
        .entreprise {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20pt;
            padding: 15pt;
            background: #f9f9f9;
        }
        
        .entreprise h3 {
            font-size: 12pt;
            margin-bottom: 8pt;
        }
        
        .entreprise p {
            margin-bottom: 4pt;
            font-size: 9pt;
        }
        
        /* Sections */
        .section {
            margin-bottom: 20pt;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 10pt;
            border-bottom: 1pt solid #000;
            padding-bottom: 5pt;
        }
        
        /* Tableaux */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15pt;
            font-size: 8pt;
        }
        
        th, td {
            border: 1pt solid #000;
            padding: 6pt;
            text-align: left;
        }
        
        th {
            background-color: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        
        /* Statistiques */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15pt;
            margin-bottom: 20pt;
        }
        
        .stat {
            border: 1pt solid #000;
            padding: 10pt;
            text-align: center;
        }
        
        .stat-value {
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 5pt;
        }
        
        .stat-label {
            font-size: 8pt;
            text-transform: uppercase;
        }
        
        /* Signatures */
        .signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 30pt;
            padding-top: 20pt;
            border-top: 1pt solid #000;
        }
        
        .signature {
            width: 150pt;
            text-align: center;
        }
        
        .signature-line {
            border-bottom: 1pt solid #000;
            height: 30pt;
            margin-bottom: 8pt;
        }
        
        .signature-title {
            font-size: 9pt;
            font-weight: bold;
            margin-bottom: 4pt;
        }
        
        .signature-name {
            font-size: 8pt;
        }
        
        /* Pied de page */
        .footer {
            margin-top: 30pt;
            padding-top: 15pt;
            border-top: 1pt solid #ccc;
            text-align: center;
            font-size: 8pt;
            color: #666;
        }
        
        /* Page break */
        .page-break {
            page-break-before: always;
        }
        
        /* Responsive pour l'impression */
        @media print {
            body { font-size: 9pt; }
            .header { padding: 15pt; }
            .title { font-size: 16pt; }
            .subtitle { font-size: 11pt; }
            .section-title { font-size: 13pt; }
            .stat-value { font-size: 14pt; }
            .signatures { margin-top: 20pt; }
        }
    </style>
</head>
<body>
    <!-- En-tête -->
    <div class="header">
        <h1 class="title">ÉTAT GÉNÉRAL DU SYSTÈME</h1>
        <p class="subtitle">Gestion des Caisses de Femmes - FKM</p>
        <div class="meta">
            <p>Généré le : {{ date_generation|date:"d/m/Y à H:i" }} | Par : {{ user.get_full_name|default:user.username }}</p>
        </div>
    </div>
    
    <!-- Informations de l'entreprise -->
    <div class="entreprise">
        <div>
            <h3>FKM - Fédération des Caisses de Femmes</h3>
            <p>Siège social : [Adresse du siège]</p>
            <p>Téléphone : [Téléphone de contact]</p>
            <p>Email : [Email de contact]</p>
        </div>
        <div>
            <p><strong>Type de document :</strong> État Général</p>
            <p><strong>Période :</strong> Toutes périodes</p>
            <p><strong>Version :</strong> 1.0</p>
        </div>
    </div>
    
    <!-- Section Statistiques Générales -->
    <div class="section">
        <h2 class="section-title">STATISTIQUES GÉNÉRALES</h2>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value">{{ total_caisses }}</div>
                <div class="stat-label">Total Caisses</div>
            </div>
            <div class="stat">
                <div class="stat-value">{{ total_membres }}</div>
                <div class="stat-label">Total Membres</div>
            </div>
            <div class="stat">
                <div class="stat-value">{{ total_prets }}</div>
                <div class="stat-label">Total Prêts</div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value">{{ total_fonds|floatformat:0 }}</div>
                <div class="stat-label">Fonds Totaux (FCFA)</div>
            </div>
            <div class="stat">
                <div class="stat-value">{{ solde_reserve|floatformat:0 }}</div>
                <div class="stat-label">Solde Réserve (FCFA)</div>
            </div>
            <div class="stat">
                <div class="stat-value">{{ solde_systeme|floatformat:0 }}</div>
                <div class="stat-label">Solde Système (FCFA)</div>
            </div>
        </div>
    </div>
    
    <!-- Section État des Prêts -->
    <div class="section">
        <h2 class="section-title">ÉTAT DES PRÊTS</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Métrique</th>
                    <th>Valeur</th>
                    <th>Montant (FCFA)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Prêts validés</td>
                    <td class="text-center">{{ prets_valides }}</td>
                    <td class="text-right">-</td>
                </tr>
                <tr>
                    <td>Prêts en cours</td>
                    <td class="text-center">{{ prets_en_cours }}</td>
                    <td class="text-right">-</td>
                </tr>
                <tr>
                    <td>Prêts remboursés</td>
                    <td class="text-center">{{ prets_rembourses }}</td>
                    <td class="text-right">-</td>
                </tr>
                <tr>
                    <td>Montant total accordé</td>
                    <td class="text-center">-</td>
                    <td class="text-right">{{ total_montant_prets|floatformat:0 }}</td>
                </tr>
                <tr>
                    <td>Montant total remboursé</td>
                    <td class="text-center">-</td>
                    <td class="text-right">{{ total_montant_rembourse|floatformat:0 }}</td>
                </tr>
                <tr>
                    <td>Montant restant</td>
                    <td class="text-center">-</td>
                    <td class="text-right">{{ total_montant_prets|add:"-"|add:total_montant_rembourse|floatformat:0 }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Section Caisse Générale -->
    <div class="section">
        <h2 class="section-title">ÉTAT DE LA CAISSE GÉNÉRALE</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Composant</th>
                    <th>Montant (FCFA)</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Solde de réserve</td>
                    <td class="text-right">{{ solde_reserve|floatformat:0 }}</td>
                    <td>Fonds de réserve disponibles</td>
                </tr>
                <tr>
                    <td>Solde total des caisses</td>
                    <td class="text-right">{{ total_fonds|floatformat:0 }}</td>
                    <td>Somme des fonds de toutes les caisses</td>
                </tr>
                <tr>
                    <td>Solde système total</td>
                    <td class="text-right">{{ solde_systeme|floatformat:0 }}</td>
                    <td>Total général du système</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Section Résumé -->
    <div class="section">
        <h2 class="section-title">RÉSUMÉ ET POINTS CLÉS</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Point clé</th>
                    <th>Détail</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Fonds disponibles</td>
                    <td>{{ total_fonds|floatformat:0 }} FCFA répartis sur {{ total_caisses }} caisses</td>
                </tr>
                <tr>
                    <td>Activité des prêts</td>
                    <td>{{ prets_en_cours }} prêts actuellement en cours</td>
                </tr>
                <tr>
                    <td>Taux de remboursement</td>
                    <td>
                        <span id="taux-remboursement">0%</span> du montant total accordé
                    </td>
                </tr>
                <tr>
                    <td>Solde de réserve</td>
                    <td>{{ solde_reserve|floatformat:0 }} FCFA dans la caisse générale</td>
                </tr>
                <tr>
                    <td>Capacité de prêt</td>
                    <td>{{ total_fonds|floatformat:0 }} FCFA disponibles pour de nouveaux prêts</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Signatures -->
    <div class="signatures">
        <div class="signature">
            <div class="signature-line"></div>
            <div class="signature-title">Président Général</div>
            <div class="signature-name">Nom du Président</div>
        </div>
        <div class="signature">
            <div class="signature-line"></div>
            <div class="signature-title">Directeur Financier</div>
            <div class="signature-name">Nom du Directeur</div>
        </div>
        <div class="signature">
            <div class="signature-line"></div>
            <div class="signature-title">Responsable Administratif</div>
            <div class="signature-name">Nom du Responsable</div>
        </div>
    </div>
    
    <!-- Pied de page -->
    <div class="footer">
        <p>Ce document a été généré automatiquement par le système de gestion des caisses</p>
        <p>© {% now "Y" %} FKM - Tous droits réservés | Page 1/1</p>
        <p>Généré le {{ date_generation|date:"d/m/Y à H:i:s" }}</p>
    </div>
    
    <script>
        // Masquer les éléments non nécessaires à l'impression
        window.addEventListener('beforeprint', function() {
            // Préparer la page pour l'impression
        });
        
        // Raccourci clavier pour l'impression
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });
        
        // Calculer le taux de remboursement
        document.addEventListener('DOMContentLoaded', function() {
            const totalMontantPrets = {{ total_montant_prets }};
            const totalMontantRembourse = {{ total_montant_rembourse }};
            
            if (totalMontantPrets > 0) {
                const taux = (totalMontantPrets / totalMontantRembourse * 100).toFixed(1);
                document.getElementById('taux-remboursement').textContent = taux + '%';
            }
        });
    </script>
</body>
</html>
